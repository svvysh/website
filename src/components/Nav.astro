---
import GithubIcon from '@/components/icons/Github.astro'
import MoonIcon from '@/components/icons/Moon.astro'
import SunIcon from '@/components/icons/Sun.astro'
import XIcon from '@/components/icons/X.astro'
import Button from '@/components/ui/Button.astro'
import Separator from '@/components/ui/Separator.astro'
import { SITE_DOMAIN, SOCIAL } from '@/lib/constants'

const navLinks = [
  { href: '#product', label: 'products' },
  { href: '#tools', label: 'tools' },
  { href: '#contact', label: 'contact' },
]
---

<nav
  class='sticky top-0 z-50 border-b border-border bg-card/70 backdrop-blur-[1px] supports-backdrop-filter:bg-card/50'
>
  <!-- System bar with navigation + controls -->
  <div class='flex items-center justify-between gap-2 py-1.5 sm:py-2 bg-muted/30 px-3 sm:px-6'>
    <div class='mt-[3px] flex items-center gap-1 sm:gap-1.5 shrink-0'>
      <span class='w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-border'></span>
      <span class='w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-border'></span>
      <span class='w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-border'></span>
    </div>

    <div class='flex flex-1 items-center gap-2 sm:gap-3 min-w-0 pl-1 sm:pl-2'>
      <div class='flex flex-1 items-center gap-2 sm:gap-3 min-w-0'>
        <span
          class='font-mono font-medium text-[9px] sm:text-[11px] text-muted-foreground truncate mr-4'
        >
          {SITE_DOMAIN}
        </span>
        <div class='hidden md:flex items-center gap-0.5 sm:gap-1'>
          {
            navLinks.map((link) => (
              <Button
                href={link.href}
                variant='ghost'
                size='xs'
                class='font-normal text-[11px] sm:text-[12px]'
              >
                {link.label}
              </Button>
            ))
          }
        </div>
      </div>

      <div class='flex items-center gap-2 sm:gap-3 shrink-0'>
        <Button
          href={SOCIAL.twitter}
          variant='ghost'
          size='xs'
          aria-label='Twitter'
          target='_blank'
          rel='noreferrer'
        >
          <XIcon />
        </Button>
        <Button
          href={SOCIAL.github}
          variant='ghost'
          size='xs'
          aria-label='GitHub'
          target='_blank'
          rel='noreferrer'
        >
          <GithubIcon />
        </Button>
      </div>

      <Separator orientation='vertical' class='h-2.5! mx-2 text-muted-foreground' />

      <div class='flex items-center gap-2 sm:gap-3 shrink-0'>
        <Button
          id='theme-toggle'
          type='button'
          variant='ghost'
          size='xs'
          class='gap-1 text-muted-foreground'
          aria-label='Toggle theme'
        >
          <SunIcon class='w-3 h-3 sm:w-3.5 sm:h-3.5 block dark:hidden' />
          <MoonIcon class='w-3 h-3 sm:w-3.5 sm:h-3.5 hidden dark:block' />
        </Button>

        <div
          class='hidden sm:block font-mono text-[9px] sm:text-[11px] text-muted-foreground shrink-0'
          id='system-time'
        >
          --:--
        </div>

        <Button
          id='mobile-menu-toggle'
          type='button'
          variant='ghost'
          size='xs'
          class='md:hidden px-1.5 py-1 text-muted-foreground'
          aria-label='Toggle menu'
        >
          <svg
            class='w-3 h-3 sm:w-3.5 sm:h-3.5'
            xmlns='http://www.w3.org/2000/svg'
            fill='none'
            viewBox='0 0 24 24'
            stroke='currentColor'
            stroke-width='1.5'
          >
            <path d='M4 6h16M4 12h16M4 18h16'></path>
          </svg>
        </Button>
      </div>
    </div>
  </div>

  <!-- Mobile nav menu -->
  <div id='mobile-menu' class='hidden md:hidden border-t border-border bg-card'>
    <div class='px-2.5 py-1.5 space-y-0.5'>
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class='block px-2.5 py-1.5 text-[12px] font-sans text-foreground/80 hover:text-foreground hover:bg-border/30'
          >
            {link.label}
          </a>
        ))
      }
    </div>
  </div>
</nav>

<script is:inline>
  // Theme toggle
  const themeToggle = document.getElementById('theme-toggle')
  themeToggle?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark')
    localStorage.setItem('theme', isDark ? 'dark' : 'light')
  })

  // Mobile menu toggle
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle')
  const mobileMenu = document.getElementById('mobile-menu')
  mobileMenuToggle?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden')
  })

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden')
    })
  })
</script>
